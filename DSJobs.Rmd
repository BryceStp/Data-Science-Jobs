
```{r Setup}
# Install packages and read in data
#install.packages("tidyverse")
library(tidyverse)
library(ggplot2)
data <- read.csv("Uncleaned_DS_jobs.csv")
# Prevents Scientific Notation 
options(scipen = 100)

view(data)
```

```{r EDA}
# First we are going to start of by doing a little EDA (some of these graphs are more helpful than others)
ggplot( data, aes(x=Salary.Estimate)) + geom_histogram(stat="count",bins=10, color='black', fill='blue')+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

```{r EDA}
# Lots of values at 0 (they weren't provided)
ggplot( data, aes(x=Founded)) + geom_histogram(stat="count", color='black', fill='blue')
```
```{r EDA}
# Lots of negative reviews (-1's), which is likely an error
ggplot( data, aes(x=Rating)) + geom_histogram(stat="count",bins=10, color='black', fill='blue')
```
```{r EDA}
# City isn't very helpful to see visually (too many unique cities)
data[c('City', 'State')] <- str_split_fixed(data$Location, ', ', 2)
#ggplot( data, aes(x=City)) + geom_histogram(stat="count",bins=10, color='black', fill='blue')+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot( data, aes(x=State)) + geom_histogram(stat="count",bins=10, color='black', fill='blue')+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```
```{r EDA}
ggplot( data, aes(x=Size)) + geom_histogram(stat="count",bins=10, color='black', fill='blue')+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```
```{r EDA}
ggplot( data, aes(x=Type.of.ownership)) + geom_histogram(stat="count",bins=10, color='black', fill='blue')+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```
```{r EDA}
# Lots of negative values in all of these plots (definitely just placeholder values)
ggplot( data, aes(x=Industry)) + geom_histogram(stat="count",bins=10, color='black', fill='blue')+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```
```{r EDA}
# More negative values here and some unknown
ggplot( data, aes(x=Sector)) + geom_histogram(stat="count",bins=10, color='black', fill='blue')+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

```{r Cleaning}
# Remove -1's from all columns (can't have negative values for any of these)
data[] <- lapply(data, gsub, pattern = "-1", replacement = "", fixed = TRUE)
```

```{r Cleaning Salary Estimate}
# We are converting the salary estimates to numeric values
# List of things to remove from column
vec1 <- c("\\(Employer" = "","K" = "000","\\$" = "")
# Split data
data[c('Salary', 'Remove')] <- str_split_fixed(data$Salary.Estimate, ' ', 2)
# Replace unwanted string with nothing
data$Salary <- str_replace_all(data$Salary, vec1)
# Split into min and max salaries
data[c('MinSalary', 'MaxSalary')] <- as.numeric(str_split_fixed(data$Salary, '-', 2)) 
# Find Average Salary
data$AvgSalary <- rowMeans(data[20:21], na.rm=TRUE)


#view(data)
#summary(data)
```

```{r Cleaning Revenue}
# Now we will do the same with Revenue and a few other columns
vec2 <- c("Unknown / Non-Applicable" = "","\\$" = "","\\+" = "","\\(USD\\)" = "")
data$Revenue <- str_replace_all(data$Revenue, vec2)
data[c('MinRevenue', 'MaxRevenue')] <- str_split_fixed(data$Revenue, 'to', 2)
# Check and replace only in MinRevenue for billion/million 
vec3 <- c(" billion" = "000000000"," million" = "000000")
data$MinRevenue <- as.numeric(str_replace_all(data$MinRevenue, vec3))
# Check MaxRevenue for million/billion and MinRevenue < 1000 and then replace
data <- data %>% 
   mutate(MinRevenue = ifelse(grepl('million', data$MaxRevenue), MinRevenue*1000000, MinRevenue))
data <- data %>% 
   mutate(MinRevenue = ifelse(grepl('billion', data$MaxRevenue), MinRevenue*1000000000, MinRevenue))
# Check and replace only in MaxRevenue for billion/million 
data$MaxRevenue <- as.numeric(str_replace_all(data$MaxRevenue, vec3))
data$AvgRevenue <- rowMeans(data[23:24], na.rm=TRUE)

#view(data)
#summary(data)
```

```{r Cleaning Company Employee Count}
# Cleaning Company Employee Count
vec3 <- c("employees" = "","\\+" = "")
data$Size <- str_replace_all(data$Size, vec3)
data[c('MinEmployeeCount', 'MaxEmployeeCount')] <- as.numeric(str_split_fixed(data$Size, 'to', 2))
data$AvgEmployeeCount <- ceiling(rowMeans(data[26:27], na.rm=TRUE))


#view(data)
#summary(data)
```

```{r Cleaning Wrap Up}
# Delete unwanted columns
data <- data[-c(1,3:4,6,17)]
# Convert all NaN types to NA (just for consistency)
data[data == "NaN"] <- NA
# Convert Rating and Founded to Numeric
data$Rating <- as.numeric(data$Rating)
data$Founded <- as.numeric(data$Founded)

summary(data)
view(data)
```

```{r Create CSV}
write.csv(data,"Cleaned_Data.csv", row.names=TRUE)
```

```{r Visualizations}
par(mfrow=c(3,1))
ggplot( data, aes(x=AvgSalary)) + geom_histogram(bins=10, color='black', fill='blue')
ggplot( data, aes(x=MaxSalary)) + geom_histogram(bins=10, color='black', fill='green')
ggplot( data, aes(x=MinSalary)) + geom_histogram(bins=10, color='black', fill='red')
```

```{r Visualizations}
par(mfrow=c(3,1))
ggplot( data, aes(x=AvgEmployeeCount)) + geom_histogram(bins=6, color='black', fill='blue')
ggplot( data, aes(x=MaxEmployeeCount)) + geom_histogram(bins=6, color='black', fill='green')
ggplot( data, aes(x=MinEmployeeCount)) + geom_histogram(bins=6, color='black', fill='red')
```

```{r Visualizations}
ggplot( data, aes(x=Rating)) + geom_histogram(bins=10, color='black', fill='blue')
```


```{r Visualizations}
ggplot( data, aes(x=Founded)) + geom_histogram(bins=10, color='black', fill='blue')
```
```{r Visualizations}
# The Histograms are not very helpful (except maybe MaxRevenue), but I left them in regardless
par(mfrow=c(3,1))
ggplot( data, aes(x=AvgRevenue)) + geom_histogram(bins=10, color='black', fill='blue')
ggplot( data, aes(x=MinRevenue)) + geom_histogram(bins=10, color='black', fill='red')
ggplot( data, aes(x=MaxRevenue)) + geom_histogram(bins=10, color='black', fill='green')

```

```{r Visualizations}
par(mfrow=c(3,1))
ggplot( data, aes(y=AvgSalary)) + geom_boxplot(color='black', fill='blue',notch=FALSE)
ggplot( data, aes(y=MinSalary)) + geom_boxplot( color='black', fill='red',notch=FALSE)
ggplot( data, aes(y=MaxSalary)) + geom_boxplot( color='black', fill='green',notch=FALSE)
```


